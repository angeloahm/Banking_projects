# 🏦 Banking Projects Repository

## Overview ✨

This repository contains Python scripts and Jupyter Notebooks designed to automate the ingestion, processing, and preliminary analysis of banking data from the FDIC. The project focuses on two primary datasets: Call Reports and the Summary of Deposits (SOD). The repository is organized into folders for data dictionaries and code, making it easier for collaborators and users to understand and extend the work.

## Repository Structure 📂

```
Banking_projects/
├── Dictionaries/              # FDIC data dictionaries & auxiliary look‑ups
├── codes/                     # All executable code lives here
│   ├── ingest_CR.py           # Download & stitch Call Report schedules per date
│   ├── ingest_SOD.py          # Download FDIC Summary of Deposits extracts
│   ├── Load_SOD.py            # Experimental API‑based SOD loader
│   ├── construct_main_df.py   # Combine quarterly CSVs → master call_reports.csv
│   ├── aux_functions.py       # Plotting & analysis utilities
│   ├── CallReports.py         # Main analysis class (select & construct vars)
│   └── …                      # Additional scripts & helpers
├── notebooks/                 # Exploratory & replication notebooks
│   ├── CR_class_test.ipynb    # Variable construction & first‑pass CR analysis
│   └── preliminary_SOD.ipynb  # First‑pass SOD analysis
├── data/                      # **Not tracked** – raw & processed datasets
└── README.md                  # ← you are here
```

- **Dictionaries/**  
  Contains FDIC data dictionaries (with hyperlinks to original sources to be added).

- **codes/**  
  Contains all project code:
  - **ingest_CR.py**: Ingests Call Report schedules for a given date and saves them as CSV.
  - **construct_main_df.py**: Merges individual CSV files into a consolidated "call_reports.csv".
  - **CallReports.py**: Construct a class with key functions to create the main dataset.
  - **mappings.py**: File with the dictionary of definitions that will be used to construct the definitions of all variables. Will be an input to functions of the 'CallReports' instance.
  - **CR_class_test.ipynb**: Jupyter notebook to analyze the data. 
  - **cr_analysis.ipynb**: Old auxiliary code. 
  - **ingest_SOD.py**: Ingests Summary of Deposits (SOD) data from the FDIC.
  - **preliminary_SOD.ipynb**: Performs preliminary analysis on SOD data.
  - **Load_SOD.py**: Experimental script for loading SOD data via an API.

## Folder & File Descriptions 📝

### Dictionaries 📚

- **Purpose:** Contains data dictionaries obtained from the FDIC website.
- **Note:** While the exact source links are not currently embedded, hyperlinks will be added so users can directly reference the original FDIC sources.

### codes 💻

This folder hosts all the code necessary for data ingestion, processing, and initial analysis.

- **ingest_CR.py**  
  Reads all the schedules of interest from the Call Reports for a specified date and exports the data as a CSV file named with the corresponding date.
  
- **construct_main_df.py**  
  Combines the individual CSV files generated by `ingest_CR.py` into a single file named `call_reports.csv`.

- **CallReports.py**
  Processes the consolidated `call_reports.csv` file to define key financial variables (such as Deposits, Loans, Assets, etc.). This file uses data from schedules FFIEC 031 and 041 (dependent on the bank) to construct these variables and perform an initial analysis. The class will just ask for the path where the .csv file is located so it can read and treat selected variables.

- **mappings.py**  
  File with a set of dictionaries containing the main variables of interest.
  
- **ingest_SOD.py**  
  Similar to `ingest_CR.py`, this script focuses on ingesting the Summary of Deposits (SOD) data from the FDIC.

- **preliminary_SOD.ipynb**  
  Reads the CSV file generated by `ingest_SOD.py` and conducts a preliminary analysis on the SOD data.

- **Load_SOD.py**  
  An experimental script intended to load SOD data using an API.

## How to Use 🚀

1. **Data Ingestion:**
   - Download the 'Call Reports Single Period' files from: This script downloads the Call Reports Single Period data from [this link](https://cdr.ffiec.gov/public/pws/downloadbulkdata.aspx).
   - Run `ingest_CR.py` to collect Call Reports schedules for your chosen date. 
   - Run `ingest_SOD.py` to collect the Summary of Deposits data.

2. **Data Processing:**
   - Execute `construct_main_df.py` to merge individual CSV files into a single `call_reports.csv`.
   - Use `CallReports.py` and `mappings.py`, to construct specific financial variables.
## Core modules

### `CallReports.py`

A thin, documented wrapper around pandas that understands the quirks of MDRM codes.

```python
from codes.CallReports import CallReports
cr = CallReports("data/clean")

# ------------------------------------------------------------------
# 1) Basic audit: Do foreign (RCFD) and domestic (RCON) flavours match?
# ------------------------------------------------------------------
cr.select_variables(["RCFD3210", "RCON3210"])        # Total equity capital
summary = cr.compare_variables("RCFD3210", "RCON3210")
print(summary)
# {'both_valid': 4_500, 'RCFD_only': 0, 'RCON_only': 0,
#  'both_NaN': 12, 'identical': True}

# ------------------------------------------------------------------
# 2) Decide which flavour to keep on the fly
# ------------------------------------------------------------------
pair = ("RCFD2200", "RCON2200")                      # Total liabilities
cr.select_variables(list(pair))
qc = cr.compare_variables(*pair)
preferred = pair[0] if qc["RCON_only"] > qc["RCFD_only"] else pair[1]
print(f"Will keep → {preferred}")

# ------------------------------------------------------------------
# 3) Write a quick sanity-check loop across many code pairs
# ------------------------------------------------------------------
code_roots = ["2170", "3368", "2210"]                # Assets, Deposits, Loans …
report = {}
for root in code_roots:
    f, d = f"RCFD{root}", f"RCON{root}"
    cr.select_variables([f, d])
    audit = cr.compare_variables(f, d)
    report[root] = audit["RCFD_only"] + audit["RCON_only"]

print("Rows with mismatches per code:", report)

# ------------------------------------------------------------------
# 4) Build a “best-of-both” column directly
# ------------------------------------------------------------------
pair = ("RCFD1400", "RCON1400")                      # Fed Funds purchased
cr.select_variables(list(pair))
mappings = [{
    "new_var": "Loans",
    "first_col": pair[0],          # Fallback
    "second_col": pair[1],         # Priority
    "method": "secondary"          # Use second if present, else first
}]
cr.construct_definitions(mappings)
cr.df_constructed[["fedfunds_clean"]].head()
```

### `aux_functions.py`

Reusable plotting helpers:

* `plot_with_range` – time‑series ribbon with mean/25‑75 percentile/min‑max.
* `binned_scatter` – mean (and dispersion) of *y* across quantiles of *x*.
* `lorenz_points` – pre‑baked Lorenz‑curve coordinates.

---



3. **API Loading (Experimental):**
   - Use `Load_SOD.py` for testing the API-based approach to load SOD data.

## Dependencies 📦

- **Python 3.x**  
- Required packages (e.g., `pandas`, `numpy`, `matplotlib`, etc.)  
  _Make sure to install the necessary packages via `pip` or your preferred package manager. A requirements file may be added in the future for convenience._

## Acknowledgements 🙏

- **Data Source:** Federal Deposit Insurance Corporation (FDIC)
- **Contributors:** [angeloahm](https://github.com/angeloahm) and [BelmudesLSB](https://github.com/BelmudesLSB).

## Future Updates 🔮

- **Data Dictionaries:** Hyperlinks to the exact FDIC data sources will be embedded in the `Dictionaries` folder.
- **Documentation:** Additional documentation, examples, and enhancements will be added as the project evolves.
